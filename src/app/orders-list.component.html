<div class="orders">
  <div class="header-row">
    <h2>Orders</h2>

    <div class="header-actions">
      <a class="primary-btn" [routerLink]="['/orders/new']">Create order</a>
    </div>
  </div>

  <table class="orders-table" *ngIf="orders && orders.length > 0; else emptyState">
    <thead>
      <tr>
        <th (click)="setSort('id')" class="sortable">
          ID
          <span class="sort-indicator" *ngIf="sortBy === 'id'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th (click)="setSort('code')" class="sortable">
          Code
          <span class="sort-indicator" *ngIf="sortBy === 'code'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th (click)="setSort('customerName')" class="sortable">
          Customer
          <span class="sort-indicator" *ngIf="sortBy === 'customerName'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th (click)="setSort('createdAt')" class="sortable">
          Created
          <span class="sort-indicator" *ngIf="sortBy === 'createdAt'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th (click)="setSort('total')" class="sortable right">
          Total
          <span class="sort-indicator" *ngIf="sortBy === 'total'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th (click)="setSort('status')" class="sortable">
          Status
          <span class="sort-indicator" *ngIf="sortBy === 'status'">{{ sortDir === 'asc' ? '↑' : '↓' }}</span>
        </th>

        <th class="actions">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr
        *ngFor="let o of orders"
        [ngClass]="{
          'row-cancelled': isCancelled(o),
          'row-paid': isPaid(o),
          'row-shipped': isShipped(o)
        }"
      >
        <td>{{ o.id }}</td>

        <td>
          <a [routerLink]="['/orders', o.id]" class="link" (click)="$event.stopPropagation()">
            {{ o.code }}
          </a>
        </td>

        <td>{{ o.customerName ? o.customerName : '-' }}</td>
        <td>{{ formatDate(o.createdAt) }}</td>
        <td class="right">{{ formatMoney(o.total) }}</td>

        <td>
          <span
            class="status-pill"
            [ngClass]="{
              'pill-cancelled': isCancelled(o),
              'pill-paid': isPaid(o),
              'pill-shipped': isShipped(o),
              'pill-new': isNew(o)
            }"
          >
            {{ o.status }}
          </span>
        </td>

        <td class="actions">
          <a href="" (click)="$event.preventDefault(); editOrder(o.id)" class="action-link">Edit</a>
          <a href="" (click)="$event.preventDefault(); deleteOrder(o.id)" class="action-link danger">Delete</a>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #emptyState>
    <div class="empty">No orders found.</div>
  </ng-template>

  <div class="pagination" *ngIf="totalPages > 0">
    <div class="meta">
      <span>Page {{ page + 1 }} / {{ totalPages }}</span>
      <span>Total: {{ totalElements }}</span>
    </div>

    <div class="controls">
      <button type="button" (click)="goToFirstPage()" [disabled]="loading || page === 0">First</button>
      <button type="button" (click)="goToPreviousPage()" [disabled]="loading || page === 0">Prev</button>
      <button type="button" (click)="goToNextPage()" [disabled]="loading || page >= totalPages - 1">Next</button>
      <button type="button" (click)="goToLastPage()" [disabled]="loading || page >= totalPages - 1">Last</button>

      <label class="size">
        Size:
        <select [disabled]="loading" [(ngModel)]="size" (ngModelChange)="loadPage(0)" name="size">
          <option [ngValue]="5">5</option>
          <option [ngValue]="10">10</option>
          <option [ngValue]="20">20</option>
          <option [ngValue]="50">50</option>
        </select>
      </label>
    </div>
  </div>

  <div class="loading" *ngIf="loading">Loading...</div>
</div>